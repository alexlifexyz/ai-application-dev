server:
  port: 8080
  servlet:
    context-path: /
  
spring:
  application:
    name: ai-application-dev
  
  # Jackson 配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    default-property-inclusion: non_null

# Springdoc OpenAPI 配置
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: 'default'
      paths-to-match: '/**'
      packages-to-scan: com.alex.ai.controller

# LangChain4j 配置
langchain4j:
  open-ai:
    chat-model:
      # API Key（通过环境变量配置，留空则启用演示模式）
      api-key: ${OPENAI_API_KEY:sk-90a86cbf6aee493d84554454eb39e785}
      # API 基础 URL（支持 OpenAI 兼容接口）
      base-url: ${OPENAI_BASE_URL:https://dashscope.aliyuncs.com/compatible-mode/v1}
      # 模型名称
      model-name: ${OPENAI_MODEL:qwen-flash}
      # 温度参数（0-2，越高越随机）
      temperature: 0.7
      # 最大 token 数
      max-tokens: 2000
      # 超时时间
      timeout: 60s
      # 日志请求（开发环境可开启）
      log-requests: true
      log-responses: true
    
    # Embedding 模型配置（向量检索功能）
    # 使用通义千问 text-embedding-v3（与 base-url 配置的 API 兼容）
    # 如使用 OpenAI 原生 API，可改为 text-embedding-3-small
    embedding-model:
      api-key: ${OPENAI_API_KEY:sk-90a86cbf6aee493d84554454eb39e785}
      model-name: text-embedding-v3
      timeout: 30s

  # 对话记忆配置
  chat-memory:
    # 保留最近的消息数
    max-messages: 10

# 会话配置
conversation:
  session:
    # 会话过期时间（分钟）
    expire-minutes: ${SESSION_EXPIRE_MINUTES:30}
    # 清理任务执行间隔（分钟）
    cleanup-interval-minutes: ${SESSION_CLEANUP_INTERVAL:5}
    # 最大会话数量
    max-sessions: ${SESSION_MAX_COUNT:1000}

# 日志配置
logging:
  level:
    root: INFO
    com.alex.ai: DEBUG
    dev.langchain4j: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"

# 管理端点配置（可选）
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

# RAG 向量存储配置
rag:
  vector-store:
    # 存储类型：memory（内存，默认）| chroma（持久化）
    type: ${RAG_VECTOR_STORE_TYPE:chroma}
    
    # Chroma 配置（当 type=chroma 时生效）
    chroma:
      # Chroma 服务地址（Docker: docker run -d -p 8000:8000 chromadb/chroma）
      base-url: ${CHROMA_BASE_URL:http://localhost:8000}
      # 集合名称
      collection-name: ${CHROMA_COLLECTION:ai-knowledge}

# API 安全配置
api:
  security:
    # 是否启用 API Key 认证（默认关闭，开发阶段无需认证）
    enabled: ${API_AUTH_ENABLED:false}
    # 有效的 API Key 列表（生产环境通过环境变量配置）
    api-keys:
      - ${API_KEY_1:}
      - ${API_KEY_2:}
    # API Key 请求头名称
    header-name: X-API-Key
    # 白名单路径
    exclude-paths:
      - /api/chat/health
      - /swagger-ui/**
      - /v3/api-docs/**
      - /actuator/**
    # 限流配置
    rate-limit:
      # 是否启用限流
      enabled: ${RATE_LIMIT_ENABLED:true}
      # 每分钟全局最大请求数
      requests-per-minute: 120
      # 每个 IP 每分钟最大请求数
      requests-per-minute-per-ip: 60
      # 聊天接口每分钟最大请求数
      chat-requests-per-minute: 30
